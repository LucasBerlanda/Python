{% extends 'base.html' %}

{% block content %}
<div class="col-sm-offset-3 col-sm-9 col-lg-offset-2 col-lg-10">
    <div class="row">
        <ol class="breadcrumb">
            <li><a href="{{url_for('cadastroTipoBomba')}}">
                <i class="fas fa-warehouse"></i>
            </a></li>
            <li class="active"> Almoxarifado / Entrada</li>
        </ol>
    </div><!--/.row-->

    <div class="row">
        <form action="" method="post">
            <div class="col-xs-12">
                <div class="col-xs-10 col-sm-2">
                    <div class="form-group">
                        <label>Modelo</label>
                        <select id="modelo" class="form-control" name="modelo" required>
                            <option selected="selected" disabled>Selecione</option>
                            <option value="1">Bomba</option>
                            <option value="2">Peça</option>
                        </select>
                    </div>
                </div>
                <div id="peca" class="col-xs-10 col-sm-4">
                    <div class="form-group">
                        <label>Descrição Peca:</label>
                        <select class="form-control" name="equipamento" id="eq_peca" required>
                            <option selected="selected" disabled>Selecione</option>
                            {% for peca in pecas %}
                                <option data-estoque="{{ peca.qtEstoque }}" value="{{ peca.id }}">{{ peca.nome }} - {{ peca.descricao }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div id="bomba" class="col-xs-10 col-sm-4">
                    <div class="form-group">
                        <label>Descrição Bomba:</label>
                        <select class="form-control" name="equipamento" id="eq_bomba" required>
                            <option selected="selected" disabled>Selecione</option>
                            {% for bomba in bombas %}
                                <option data-estoque="{{ bomba.qtEstoque }}" value="{{ bomba.id }}">Modelo - {{ bomba.tipo }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="col-xs-10 col-sm-2">
                    <div class="form-group">
                        <label>Qt. em Estoque:</label>
                        <input id="estoque" class="form-control" readonly type="number" value="">
                    </div>
                </div>
                <div class="col-xs-10 col-sm-2">
                    <div class="form-group">
                        <label>Qt. de Entrada:</label>
                        <input id="entrada" class="form-control" type="Number" min="1">
                    </div>
                </div>
                <div class="col-xs-10 col-sm-2">
                    <div class="form-group">
                        <label>Total:</label>
                        <input id="totalEstoque" class="form-control" readonly type="number" value="">
                    </div>
                </div>
                <div class="col-xs-10 col-sm-2">
                    <div class="form-group">
                        <label>Data Entrada:</label>
                        <div class='input-group date' id='calendario'>
                            <input class="form-control" name="data" id="" type="text" data-mask="data" value="" data-type="datepicker"/>
                            <span class="input-group-addon">
                                <i class="fa fa-calendar"></i>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<script type="text/javascript">
    $(function () {
        $('#calendario').datepicker({

        });
    });
</script>

<script>
    $('#bomba').hide();
    $('#peca').hide();

    $(document).ready(function(){
        $('#modelo').change(function(){
            var modelo = $('#modelo option:selected');
            var modeloSelecionado = modelo.val();
            document.getElementById('estoque').value = 0

            if(modeloSelecionado == 1){
               $('#bomba').show();
               $('#peca').hide();

               $(document).ready(function(){
                    $('#eq_bomba').change(function(){
                        var quantidadeEstoque = $(this).find(':selected').attr('data-estoque');

                        document.getElementById('totalEstoque').value = 0

                        document.getElementById('entrada').value = 0

                        document.getElementById('estoque').value = quantidadeEstoque

                        $("#entrada").focusout(function(){
                            var entrada = $("#entrada").val();
                            var total = parseInt(quantidadeEstoque) + parseInt(entrada);
                            document.getElementById('totalEstoque').value = total;
                        });
                    });
                });

            }else if(modeloSelecionado == 2){
                $('#peca').show();
                $('#bomba').hide();

                $(document).ready(function(){
                    $('#eq_peca').change(function(){
                        var quantidadeEstoque = $(this).find(':selected').attr('data-estoque');

                        document.getElementById('totalEstoque').value = 0

                        document.getElementById('entrada').value = 0

                        document.getElementById('estoque').value = quantidadeEstoque

                        $("#entrada").focusout(function(){
                            var entrada = $("#entrada").val();
                            var total = parseInt(quantidadeEstoque) + parseInt(entrada);
                            document.getElementById('totalEstoque').value = total;
                        });
                    });
                });
            }
        });
    });



</script>

$
{% endblock %}
